category: Data Enrichment & Threat Intelligence
commonfields:
  id: Flashpoint
  version: -1
configuration:
- defaultvalue: https://fp.tools
  display: URL
  name: url
  required: true
  type: 0
- defaultvalue: ""
  display: API Key
  name: api_key
  required: true
  type: 4
- defaultvalue: ""
  display: Trust any certificate (not secure)
  name: insecure
  required: false
  type: 8
- defaultvalue: ""
  display: Use system proxy settings
  name: proxy
  required: false
  type: 8
description: Use the Flashpoint integration to reduce business risk.
detaileddescription: "Configure an API account on Flashpoint\n-------------------------------\n
  - Login/Register at [Flashpoint](https://fp.tools/) platform. \n - Navigate to API
  & Integrations and select the **Manage API Tokens**.\n - Click on \"GENERATE TOKEN\"
  button and enter the required details to generate\n    token. (i.e- token label,username
  and password)\n - Click on GENERATE button once all required data are entered.\n\n\nConfigure
  Flashpoint instance on Demisto\n-------------------------------\n\n1.  Navigate
  to **Settings** \\> **Integrations**  \\> **Servers &\n    Services**.\n2.  Search
  for Flashpoint.\n3.  Click **Add instance** to create and configure a new integration\n
  \   instance.\n    -   **Name**: a textual name for the integration instance.\n
  \   -   **URL**: URL of the Flashpoint platform (default is https://fp.tools)\n
  \   -   **API Key**: The API key generated using above steps\n    -   **Trust any
  certificate (not secure)**: Whether to trust any SSL certificate while communicating
  with Flashpoint \n    -   **Use system proxy settings**: Whether to use system proxy
  settings\n\n4.  Click **Test** to validate the new instance.\n"
display: Flashpoint
image: data:image/png;base64,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
name: Flashpoint
script:
  commands:
  - arguments:
    - default: true
      description: The IP address to check.
      isArray: true
      name: ip
    description: Looks up details of an IP indicator. The reputation of the IP address
      is considered malicious if there's at least one IOC event in the Flashpoint
      database that matches the IP indicator. Alternatively, the IP address is considered
      suspicious if it matches any one of the Torrent's Peer IP Address or Forum Visit's
      Peer IP Address.
    name: ip
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Score
      description: The indicator score.
      type: number
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: IP.Address
      description: The IP address.
      type: string
    - contextPath: IP.Malicious.Description
      description: The description of the malicious indicator.
      type: string
    - contextPath: IP.Malicious.Vendor
      description: The vendor used to calculate the severity of the IP address.
      type: string
    - contextPath: Flashpoint.IP.Event.Href
      description: A list of reference links of the indicator.
      type: string
    - contextPath: Flashpoint.IP.Event.Address
      description: The IP address of the indicator.
      type: string
    - contextPath: Flashpoint.IP.Event.EventDetails
      description: The event details in which the indicator was observed.
      type: string
    - contextPath: Flashpoint.IP.Event.Category
      description: The category of the indicator.
      type: string
    - contextPath: Flashpoint.IP.Event.Fpid
      description: The Flashpoint ID of the indicator.
      type: string
    - contextPath: Flashpoint.IP.Event.Timestamp
      description: The time and date that the indicator was observed.
      type: string
    - contextPath: Flashpoint.IP.Event.Type
      description: The indicator type.
      type: string
    - contextPath: Flashpoint.IP.Event.Uuid
      description: The UUID of the indicator.
      type: string
    - contextPath: Flashpoint.IP.Event.Comment
      description: The comment that was provided when the indicator was observed.
      type: string
  - arguments:
    - default: true
      description: The domain name to check.
      isArray: true
      name: domain
    description: Lookup the "Domain" type indicator details. The reputation of Domain
      is considered Malicious if there's at least one IOC event in Flashpoint database
      matching the Domain indicator.
    name: domain
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Score
      description: The indicator score.
      type: number
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: Flashpoint.Domain.Event.Href
      description: A list of reference links of the indicator.
      type: string
    - contextPath: Flashpoint.Domain.Event.Domain
      description: The domain of the indicator.
      type: string
    - contextPath: Flashpoint.Domain.Event.EventDetails
      description: The event details in which the indicator was observed.
      type: string
    - contextPath: Flashpoint.Domain.Event.Category
      description: The category of the indicator.
      type: string
    - contextPath: Flashpoint.Domain.Event.Fpid
      description: The Flashpoint ID of the indicator.
      type: string
    - contextPath: Flashpoint.Domain.Event.Timestamp
      description: The time and date that the indicator was observed.
      type: string
    - contextPath: Flashpoint.Domain.Event.Type
      description: The indicator type.
      type: string
    - contextPath: Flashpoint.Domain.Event.Uuid
      description: The UUID of the indicator.
      type: string
    - contextPath: Flashpoint.Domain.Event.Comment
      description: The comment that was provided when the indicator was observed.
      type: string
    - contextPath: Domain.Malicious.Description
      description: The description of the malicious indicator.
      type: string
    - contextPath: Domain.Malicious.Vendor
      description: Vendor of malicious indicator.
      type: string
    - contextPath: Domain.Name
      description: Name of domain.
      type: string
  - arguments:
    - default: true
      description: The file name to check.
      isArray: true
      name: filename
    description: Lookup the "Filename" type indicator details. The reputation of Filename
      is considered Malicious if there's at least one IOC event in Flashpoint database
      matching the Filename indicator.
    name: filename
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Score
      description: The indicator score.
      type: number
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: Flashpoint.Filename.Event.Href
      description: A list of reference links of the indicator.
      type: string
    - contextPath: Flashpoint.Filename.Event.Filename
      description: Filename of the indicator
      type: string
    - contextPath: Flashpoint.Filename.Event.EventDetails
      description: The event details in which the indicator was observed.
      type: string
    - contextPath: Flashpoint.Filename.Event.Category
      description: The category of the indicator.
      type: string
    - contextPath: Flashpoint.Filename.Event.Fpid
      description: The Flashpoint ID of the indicator.
      type: string
    - contextPath: Flashpoint.Filename.Event.Timestamp
      description: The time and date that the indicator was observed.
      type: string
    - contextPath: Flashpoint.Filename.Event.Type
      description: The indicator type.
      type: string
    - contextPath: Flashpoint.Filename.Event.Uuid
      description: The UUID of the indicator.
      type: string
    - contextPath: Flashpoint.Filename.Event.Comment
      description: The comment that was provided when the indicator was observed.
      type: string
  - arguments:
    - default: true
      description: The url to check.
      isArray: true
      name: url
    description: Lookup the "URL" type indicator details. The reputation of Url is
      considered Malicious if there's at least one IOC event in Flashpoint database
      matching the Url indicator.
    name: url
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Score
      description: The indicator score.
      type: number
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: Flashpoint.Url.Event.Href
      description: A list of reference links of the indicator.
      type: string
    - contextPath: Flashpoint.Url.Event.Url
      description: Url of the indicator
      type: string
    - contextPath: Flashpoint.Url.Event.EventDetails
      description: The event details in which the indicator was observed.
      type: string
    - contextPath: Flashpoint.Url.Event.Category
      description: The category of the indicator.
      type: string
    - contextPath: Flashpoint.Url.Event.Fpid
      description: The Flashpoint ID of the indicator.
      type: string
    - contextPath: Flashpoint.Url.Event.Timestamp
      description: The time and date that the indicator was observed.
      type: string
    - contextPath: Flashpoint.Url.Event.Type
      description: The indicator type.
      type: string
    - contextPath: Flashpoint.Url.Event.Uuid
      description: The UUID of the indicator.
      type: string
    - contextPath: Flashpoint.Url.Event.Comment
      description: The comment that was provided when the indicator was observed.
      type: string
    - contextPath: URL.Malicious.Description
      description: The description of the malicious indicator.
      type: string
    - contextPath: URL.Malicious.Vendor
      description: Vendor of malicious url.
      type: string
  - arguments:
    - default: true
      description: A list of hashes of the file to query. Supports MD5, SHA1 and SHA256.
      isArray: true
      name: file
    description: Lookup the "File" type indicator details. The reputation of File-hash
      is considered Malicious if there's at least one IOC event in Flashpoint database
      matching the File-hash indicator.
    name: file
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Score
      description: The indicator score.
      type: number
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: Flashpoint.File.Event.Href
      description: A list of reference links of the indicator.
      type: string
    - contextPath: Flashpoint.File.Event.MD5
      description: MD5 file hash of the indicator
      type: string
    - contextPath: Flashpoint.File.Event.SHA1
      description: SHA1 file hash of the indicator
      type: string
    - contextPath: Flashpoint.File.Event.SHA256
      description: SHA256 file hash of the indicator
      type: string
    - contextPath: Flashpoint.File.Event.EventDetails
      description: The event details in which the indicator was observed.
      type: string
    - contextPath: Flashpoint.File.Event.Category
      description: The category of the indicator.
      type: string
    - contextPath: Flashpoint.File.Event.Fpid
      description: The Flashpoint ID of the indicator.
      type: string
    - contextPath: Flashpoint.File.Event.Timestamp
      description: The time and date that the indicator was observed.
      type: string
    - contextPath: Flashpoint.File.Event.Type
      description: The indicator type.
      type: string
    - contextPath: Flashpoint.File.Event.Uuid
      description: The UUID of the indicator.
      type: string
    - contextPath: Flashpoint.File.Event.Comment
      description: The comment that was provided when the indicator was observed.
      type: string
    - contextPath: File.Malicious.Description
      description: The description of the malicious indicator.
      type: string
    - contextPath: File.Malicious.Vendor
      description: Vendor of malicious file.
      type: string
    - contextPath: File.MD5
      description: MD5 type file.
      type: string
    - contextPath: File.SHA1
      description: SHA1 type file.
      type: string
    - contextPath: File.SHA256
      description: SHA256 type file.
      type: string
  - arguments:
    - default: true
      description: The email to check.
      isArray: true
      name: email
    description: Lookup the "Email" type indicator details. The reputation of Email
      is considered Malicious if there's at least one IOC event in Flashpoint database
      matching the Email indicator.
    name: email
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Score
      description: The indicator score.
      type: number
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
    - contextPath: Flashpoint.Email.Event.Href
      description: A list of reference links of the indicator.
      type: string
    - contextPath: Flashpoint.Email.Event.EventDetails
      description: The event details in which the indicator was observed.
      type: string
    - contextPath: Flashpoint.Email.Event.Category
      description: The category of the indicator.
      type: string
    - contextPath: Flashpoint.Email.Event.Fpid
      description: The Flashpoint ID of the indicator.
      type: string
    - contextPath: Flashpoint.Email.Event.Timestamp
      description: The time and date that the indicator was observed.
      type: string
    - contextPath: Flashpoint.Email.Event.Type
      description: The indicator type.
      type: string
    - contextPath: Flashpoint.Email.Event.Uuid
      description: The UUID of the indicator.
      type: string
    - contextPath: Flashpoint.Email.Event.Comment
      description: The comment that was provided when the indicator was observed.
      type: string
    - contextPath: Account.Email.Malicious.Description
      description: The description of the malicious indicator.
      type: string
    - contextPath: Account.Email.Malicious.Vendor
      description: Vendor of Malicious email.
      type: string
    - contextPath: Account.Email.Name
      description: Name of indicator.
      type: string
  - arguments:
    - description: Search report using keyword or text
      name: report_search
      required: true
    description: Search for the Intelligence Reports using a keyword
    name: flashpoint-search-intelligence-reports
    outputs:
    - contextPath: Flashpoint.Report
      description: List of reports based on specified search query or keyword
  - arguments:
    - description: The report id of the report for which the details are to be fetched.
        The report id can be known from output context path (Flashpoint.Report.ReportId)
        of report-search command or some other investigation.
      name: report_id
      required: true
    description: Get single report details using the report id. The report id can
      be known from output context path (Flashpoint.Report.ReportId) of report-search
      command or some other investigation.
    name: flashpoint-get-single-intelligence-report
    outputs:
    - contextPath: Flashpoint.Report.NotifiedAt
      description: Notify date of report.
      type: string
    - contextPath: Flashpoint.Report.PlatformUrl
      description: Platform url of report. It helps to redirect flashpoint platform.
      type: string
    - contextPath: Flashpoint.Report.PostedAt
      description: posted date of report.
      type: number
    - contextPath: Flashpoint.Report.Summary
      description: Summary of report.
      type: string
    - contextPath: Flashpoint.Report.Title
      description: Title of the report.
      type: string
    - contextPath: Flashpoint.Report.UpdatedAt
      description: Last updated date of report.
      type: string
    - contextPath: Flashpoint.Report.ReportId
      description: Unique id of the report.
      type: string
  - arguments:
    - description: The report-id of the report of which the related reports are to
        be fetched. The report id can be known from output context path (Flashpoint.Report.ReportId)
        of report-search command or some other investigation.
      name: report_id
      required: true
    description: Get related reports for a particular report using the report-id.
      The report id can be known from output context path (Flashpoint.Report.ReportId)
      of report-search command or some other investigation.
    name: flashpoint-get-related-reports
    outputs:
    - contextPath: Flashpoint.Report
      description: Display list of related report based on report fpid.
  - arguments:
    - description: The UUID or FPID that identifies a particular event. The event
        id can be fetched from output context path (Flashpoint.Event.EventId) get-events
        command or indicator reputation command response or some other investigation.
      name: event_id
      required: true
    description: Retrieves the details of a single event using event UUID or FPID.
      To retrieve the event id, run the get-events command and see the value under
      the Flashpoint.Event.EventId context path. or indicator reputation command response
      or some other investigation.
    name: flashpoint-get-single-event
    outputs:
    - contextPath: Flashpoint.Event.ObservedTime
      description: The date that the event was triggered.
      type: string
    - contextPath: Flashpoint.Event.EventCreatorEmail
      description: The email address of the event creator.
      type: string
    - contextPath: Flashpoint.Event.Href
      description: The display event reference.
      type: string
    - contextPath: Flashpoint.Event.Tags
      description: The display event tags.
    - contextPath: Flashpoint.Event.EventId
      description: The display event ID (event fpid).
      type: string
    - contextPath: Flashpoint.Event.Name
      description: The name of the event.
      type: string
  - arguments:
    - description: The time period for the search.
      name: time_period
    - description: The report fpid. To retrieve the report fpid, run the related-reports
        command.
      name: report_fpid
    - defaultValue: "10"
      description: Specify the limit on the no. of record.
      name: limit
    - description: A comma-separated list of attack IDs for which to search. Attack
        IDs can be found in event information or on the Flashpoint platform by filtering
        events by attack IDs.
      name: attack_ids
    description: Searches for events within the specified time-period, the report
      fpid, or attack IDs.
    name: flashpoint-get-events
    outputs:
    - contextPath: Flashpoint.Event
      description: A list of multiple events.
  - arguments:
    - default: true
      description: The indicator type, for example, domain, ip, email, url, and so
        on.
      isArray: true
      name: indicator
    description: Lookup any type of indicator
    name: flashpoint-common-lookup
    outputs:
    - contextPath: DBotScore.Indicator
      description: The indicator that was tested.
      type: string
    - contextPath: DBotScore.Score
      description: The indicator score.
      type: number
    - contextPath: DBotScore.Type
      description: The indicator type.
      type: string
    - contextPath: DBotScore.Vendor
      description: The vendor used to calculate the score.
      type: string
  - arguments:
    - description: Specify forum id of the forum for which the details are to be fetched.
        The forum id can be known from context path (Flashpoint.Forum.ForumId or Flashpoint.Forum.Post.Forum.id)
        of flashpoint-search-forum-posts command or some other investigation.
      name: forum_id
      required: true
    description: Retrieves forum details using the forum ID. To retrieve the forum
      ID run the flashpoint-search-forum-posts command and see the value under the
      following context paths, Flashpoint.Forum.ForumId or Flashpoint.Forum.Post.Forum.id.
    name: flashpoint-get-forum-details
    outputs:
    - contextPath: Flashpoint.Forum.Description
      description: Detailed information of the supplied forum ID.
      type: string
    - contextPath: Flashpoint.Forum.Hostname
      description: Host details of the supplied forum ID.
      type: string
    - contextPath: Flashpoint.Forum.Name
      description: The name of forum.
      type: string
    - contextPath: Flashpoint.Forum.Stats
      description: Statistical information such as the number of posts, rooms, threads,
        and users details.
    - contextPath: Flashpoint.Forum.Tags
      description: A list of forum tags, including id, name, parent_tag, and UUID.
    - contextPath: Flashpoint.Forum.ForumId
      description: The Forum ID.
      type: string
  - arguments:
    - description: The room ID for which to retrieve room information in a forum.
        To retrieve the room ID run the flashpoint-search-forum-posts command and
        see the value under the Flashpoint.Forum.Post.Room.id context path.
      name: room_id
      required: true
    description: Retrieves forum room details using the room ID. To retrieve the room
      ID run the flashpoint-search-forum-posts command and see the value under the
      Flashpoint.Forum.Post.Room.id context path.
    name: flashpoint-get-forum-room-details
    outputs:
    - contextPath: Flashpoint.Forum.Room.Forum
      description: Forum details, including forum name, hostname, platform url, stats,
        tags, and so on.
    - contextPath: Flashpoint.Forum.Room.Title
      description: The room title. You can use the same title in the forum search
        command.
      type: string
    - contextPath: Flashpoint.Forum.Room.Url
      description: The forum room URL.
      type: string
    - contextPath: Flashpoint.Forum.Room.RoomId
      description: The forum room ID.
      type: string
  - arguments:
    - description: The user ID used to retrieve a user's information. To retrieve
        the user ID, run the flashpoint-search-forum-posts command and see the value
        under the Flashpoint.Forum.Post.User.id context path.
      name: user_id
      required: true
    description: Retrieves user details using the user-id. To retrieve the user ID,
      run the flashpoint-search-forum-posts command and see the value under the Flashpoint.Forum.Post.User.id
      context path.
    name: flashpoint-get-forum-user-details
    outputs:
    - contextPath: Flashpoint.Forum.User.Forum
      description: Forum details, including id, hostname, description, stats, tags,
        and so on.
    - contextPath: Flashpoint.Forum.User.Name
      description: The name of the user.
      type: string
    - contextPath: Flashpoint.Forum.User.PlatformUrl
      description: The platform URL of the user which is redirected to Flashpoint
        platform.
      type: string
    - contextPath: Flashpoint.Forum.User.Url
      description: The URL of user.
      type: string
    - contextPath: Flashpoint.Forum.User.UserId
      description: The unique ID of the forum user.
      type: string
  - arguments:
    - description: The post ID, which gives post information embedded within the forum,
        room, user, and so on. To retrieve the post ID, run the flashpoint-search-forum-posts
        and see the value under the Flashpoint.Forum.Post.PostId context path.
      name: post_id
      required: true
    description: Retrieves post details using the post-id. To retrieve the post ID,
      run the flashpoint-search-forum-posts command and see the value under the Flashpoint.Forum.Post.PostId
      context path. command or some other investigation.
    name: flashpoint-get-forum-post-details
    outputs:
    - contextPath: Flashpoint.Forum.Post.Forum
      description: Forum details of the post, including id, hostname, stats, description,
        tags, and so on.
    - contextPath: Flashpoint.Forum.Post.Room
      description: Room details of the post, including room title, id, url, platform
        url, and so on.
    - contextPath: Flashpoint.Forum.Post.User
      description: User details of the post, including user id, name, url, platform
        url, and so on.
    - contextPath: Flashpoint.Forum.Post.PlatformUrl
      description: Using platform URL user can redirect to Flashpoint platform.
      type: string
    - contextPath: Flashpoint.Forum.Post.PublishedAt
      description: The date that the post was published.
    - contextPath: Flashpoint.Forum.Post.Url
      description: The display URL of the post.
    - contextPath: Flashpoint.Forum.Post.PostId
      description: The forum post ID.
      type: string
  - arguments:
    - description: The site keyword or text for which to search. This keyword is used
        for search information in forum sites. This keyword or text is known by Flashpoint
        users.
      name: site_search
      required: true
    description: Searches forum sites using a keyword. it will search in site content
      like name, title, descripion etc.
    name: flashpoint-search-forum-sites
    outputs:
    - contextPath: Flashpoint.Forum.Site
      description: A list of forum site details based on the search keyword.
  - arguments:
    - description: The post keyword or text which is used for search information in
        forum posts, and is known by Flashpoint users.
      name: post_search
      required: true
    description: Search forum posts using a keyword
    name: flashpoint-search-forum-posts
    outputs:
    - contextPath: Flashpoint.Forum.Post
      description: A list of forum posts based on the search keyword.
  dockerimage: demisto/python3:3.7.5.4583
  runonce: false
  script: |2


    """ IMPORTS """
    import ipaddress
    import requests
    import urllib.parse
    from typing import Dict, Any

    # Disable insecure warnings
    requests.packages.urllib3.disable_warnings()

    """ CONSTANTS """
    FLASHPOINT_PATHS = {
        'IP': 'Flashpoint.IP.Event(val.Fpid && val.Fpid == obj.Fpid)',
        'Url': 'Flashpoint.URL.Event(val.Fpid && val.Fpid == obj.Fpid)',
        'Domain': 'Flashpoint.Domain.Event(val.Fpid && val.Fpid == obj.Fpid)',
        'Email': 'Flashpoint.Email.Event(val.Fpid && val.Fpid == obj.Fpid)',
        'File': 'Flashpoint.File.Event(val.Fpid && val.Fpid == obj.Fpid)',
        'Filename': 'Flashpoint.Filename.Event(val.Fpid && val.Fpid == obj.Fpid)',
        'Event': 'Flashpoint.Event(val.EventId == obj.EventId)',
        'Report': 'Flashpoint.Report(val.ReportId == obj.ReportId)',
        'Forum': 'Flashpoint.Forum(val.ForumId == obj.ForumId)',
        'Room': 'Flashpoint.Forum.Room(val.RoomId == obj.RoomId)',
        'User': 'Flashpoint.Forum.User(val.UserId == obj.UserId)',
        'Post': 'Flashpoint.Forum.Post(val.PostId == obj.PostId)',
        'Site': 'Flashpoint.Forum.Site(val.SiteId == obj.SiteId)'
    }


    class Client:
        """
        Client to use in integration with powerful http_request.
        :type api_key: ``str``
        :param api_key: Use to authenticate request in header

        :type url: ``str``
        :param url: Base server address with suffix, for example: https://example.com.

        :type verify: ``Boolean``
        :param verify: Use to indicate secure/insecure http request

        :type proxies: ``dict``
        :param proxies: proxies dict for http request

        :return response of request
        :rtype ``dict``
        """

        def __init__(self, api_key, url, verify, proxies):
            self.url = url
            self.api_key = api_key
            self.verify = verify
            self.proxies = proxies

        def http_request(self, method, url_suffix, params=None):
            """
            Get http response based on url and given parameters.

            :param method: Specify http methods
            :param url_suffix: url encoded url suffix
            :param params: None
            :return: http response on json
            """
            base_url = self.url + "/api/v4"
            full_url = base_url + url_suffix

            headers = {
                'Authorization': self.api_key
            }

            resp = requests.request(
                method,
                full_url,
                verify=self.verify,
                proxies=self.proxies,
                params=params,
                headers=headers)

            status_code = resp.status_code

            resp_json = resp.json()

            if status_code != 200:
                if status_code == 400:
                    raise ValueError(
                        "Invalid argument value while trying to get information from Flashpoint: " + resp_json.get(
                            'detail', 'N/A'))
                elif status_code == 401:
                    raise ValueError(
                        "Encountered error while trying to get information from Flashpoint: Invalid API Key is "
                        "configured")
                elif status_code == 404:
                    raise ValueError("No record found for given argument(s): Not Found")
                elif status_code in (521, 403):
                    raise ValueError("Test connectivity failed. Please provide valid input parameters.")
                else:
                    resp.raise_for_status()

            return resp_json


    ''' HELPER FUNCTIONS '''


    def get_apikey():
        """ Get API Key from the command argument"""
        api_key = demisto.params()["api_key"]

        return api_key


    def get_url_suffix(query):
        """
        Create url-suffix using the query value with url encoding

        :param query: value of query param
        :return: url-encoded url-suffix
        """
        return r'/indicators/simple?query=' + urllib.parse.quote(query.encode('utf8'))


    def parse_indicator_response(indicators):
        """
        Extract Flashpoint event details and href values from each of the indicator in an indicator list

        :param indicators: list of indicators
        :return: dict containing event details and href
        """
        events = []
        hrefs = []
        for indicator in indicators:
            hrefs.append(indicator.get('Attribute', {}).get('href', ''))

            event = indicator.get('Attribute', {}).get('Event', {})

            tags_list = [tag for tag in event['Tags']]
            tags_value = ', '.join(tags_list)

            observed_time = time.strftime('%b %d, %Y  %H:%M', time.gmtime(float(event['timestamp'])))

            events.append({
                'Date Observed (UTC)': observed_time,
                'Name': event.get('info', ''),
                'Tags': tags_value,
            })

        return {'events': events, 'href': hrefs}


    def parse_event_response(client, event, fpid, href):
        """
        Prepare required event json object from event response

        :param href: reference link of event
        :param fpid: unique id of event. i.e EventId
        :param client: object of client class
        :param event: event indicator from response
        :return: required event json object
        """
        observed_time = time.strftime('%b %d, %Y  %H:%M', time.gmtime(float(event['timestamp'])))
        name = event.get('info', '')
        uuid = event.get('uuid', '')
        if uuid:
            fp_link = client.url + '/home/technical_data/iocs/items/' + uuid
            name_str = '[{}]({})'.format(name, fp_link)
        else:
            name_str = name

        tags_list = [tag['name'] for tag in event.get('Tag', [])]
        tags_value = ', '.join(tags_list)

        event_creator_email = event.get('event_creator_email', '')

        event = {
            'Observed time (UTC)': observed_time,
            'Name': name_str,
            'Tags': tags_value,
            'EventCreatorEmail': event_creator_email,
            'EventId': fpid,
            'Href': href
        }

        return event


    def parse_forum_response(resp):
        """
        Prepare forum json object from forum response

        :param resp: forum response
        :return: required forum json object
        """
        name = resp.get('name', '')
        hostname = resp.get('hostname', '')

        tags_list = [tag['name'] for tag in resp['tags']]
        tags_value = ', '.join(tags_list)

        forum_details = {
            'Name': name,
            'Hostname': hostname,
            'Tags': tags_value
        }

        return forum_details


    def get_post_context(resp):
        """
        Prepare context data for forum post

        :param resp: forum post api response
        :return: dict object
        """
        post_ec = {
            'PostId': resp['id'],
            'PublishedAt': resp.get('published_at', ''),
            'Url': resp.get('url', ''),
            'PlatformUrl': resp.get('platform_url', ''),
            'Forum': resp['embed']['forum'],
            'Room': resp['embed']['room'],
            'User': resp['embed']['author']
        }

        return post_ec


    def reputation_operation_command(client, indicator, func):
        """
        Common method for reputation commands to accept argument as a comma-separated values and converted into list
        and call specific function for all values.

        :param client: object of client class
        :param indicator: comma-separated values or single value
        :param func: reputation command function. i.e file_lookup, domain_lookup etc.
        :return: output of all value according to specified function.
        """
        args = argToList(indicator, ',')
        for arg in args:
            return_outputs(*func(client, arg))


    def replace_key(dictionary, new_key, old_key):
        """
        This method is used for replace key in dictionary.

        :param dictionary: dictionary object on which we wan to replace key.
        :param new_key: key which will replace in dictionary
        :param old_key: existing key in dictionary
        :return: dict object
        """
        dictionary[new_key] = dictionary.pop(old_key)
        return dictionary


    ''' FUNCTIONS '''


    def ip_lookup_command(client, ip):
        """
        'ip' command to lookup a particular ip-address
        This command searches for the ip in Flashpoint's IOC Dataset. If found, mark it as Malicious.
        If not found, lookup in Torrents for matching peer ip. If found, mark it as Suspicious.
        If not found, lookup in Forums for matching ip. If found, mark it as Suspicious.


        :param client: object of client class
        :param ip: ip-address
        :return: command output
        """
        if not is_ip_valid(ip, True):
            raise ValueError("Invalid ip - " + ip)

        query = r'+type:("ip-src","ip-dst") +value.\*:"' + urllib.parse.quote(ip.encode('utf-8')) + '"'
        resp = client.http_request("GET", url_suffix=get_url_suffix(query))

        if isinstance(resp, list):
            indicators = resp
        else:
            indicators = []

        if len(indicators) > 0:

            hr = '### Flashpoint IP address reputation for ' + ip + '\n'
            hr += 'Reputation: Malicious\n\n'

            events_details = parse_indicator_response(indicators)

            hr += tableToMarkdown('Events in which this IOC observed', events_details['events'],
                                  ['Date Observed (UTC)', 'Name', 'Tags'])

            # Constructing FP Deeplink
            fp_link = client.url + '/home/search/iocs?group=indicator&ioc_type=ip-dst%2Cip-src&ioc_value=' + ip
            hr += '\nAll events and details (fp-tools): [{}]({})\n'.format(fp_link, fp_link)

            dbot_context = {
                'Indicator': ip,
                'Type': 'ip',
                'Vendor': 'Flashpoint',
                'Score': 3
            }

            ip_context = {
                'Address': ip,
                'Malicious': {
                    'Vendor': 'Flashpoint',
                    'Description': 'Found in malicious indicators dataset'
                }
            }

            flashpoint_ip_context = []
            for indicator in resp:
                indicator = indicator.get("Attribute", {})
                event = {
                    'Address': ip,
                    'EventDetails': indicator.get('Event'),
                    'Category': indicator.get('category', ''),
                    'Fpid': indicator.get('fpid', ''),
                    'Href': indicator.get('href', ''),
                    'Timestamp': indicator.get('timestamp', ''),
                    'Type': indicator.get('type', ''),
                    'Uuid': indicator.get('uuid', ''),
                    'Comment': indicator['value'].get('comment', '')
                }
                flashpoint_ip_context.append(event)

            ec = {
                'DBotScore': dbot_context,
                outputPaths['ip']: ip_context,
                FLASHPOINT_PATHS['IP']: flashpoint_ip_context
            }

            return hr, ec, resp

        else:
            # Search for IP in torrents
            torrent_search_url_suffix = '/all/search?query=+basetypes:(+torrent) +is_verified:true ' \
                                        '+ip_address:("' + urllib.parse.quote(ip.encode('utf-8')) + \
                                        '")&limit=10&_source_includes=ip_address'
            torrent_resp = client.http_request("GET", url_suffix=torrent_search_url_suffix)
            torrent_result = torrent_resp.get('hits').get('hits', [])

            if torrent_result:
                torrent_search_link = client.url + '/home/search/torrents?ip_address=' + ip

                hr = '### Flashpoint IP address reputation for ' + ip + '\n'
                hr += 'Reputation: Suspicious\n\n'
                hr += 'FP tools link to torrent search: [{}]({})\n'.format(torrent_search_link, torrent_search_link)

                ec = {
                    FLASHPOINT_PATHS['IP']: {
                        "Address": ip
                    },
                    'DBotScore': {
                        'Indicator': ip,
                        'Type': 'ip',
                        'Vendor': 'Flashpoint',
                        'Score': 2
                    }
                }
            else:
                # Search for IP in Forums
                forum_search_url_suffix = '/forums/visits?ip_address=' + urllib.parse.quote(ip.encode('utf-8'))
                forum_resp = client.http_request("GET", url_suffix=forum_search_url_suffix)
                forum_result = forum_resp.get('data', [])

                if forum_result:
                    forum_search_link = client.url + '/home/search/visits?exclude_tor_nodes_and_known_proxies=true' \
                                                     '&ip_address=' + ip

                    hr = '### Flashpoint IP address reputation for ' + ip + '\n'
                    hr += 'Reputation: Suspicious\n\n'
                    hr += 'FP tools link to Forum-visit search: [{}]({})\n'.format(forum_search_link, forum_search_link)

                    ec = {
                        FLASHPOINT_PATHS['IP']: {
                            "Address": ip
                        },
                        'DBotScore': {
                            'Indicator': ip,
                            'Type': 'ip',
                            'Vendor': 'Flashpoint',
                            'Score': 2
                        }
                    }
                else:
                    hr = '### Flashpoint IP address reputation for ' + ip + '\n'
                    hr += 'Reputation: Unknown\n\n'
                    ec = {
                        'DBotScore': {
                            'Indicator': ip,
                            'Type': 'ip',
                            'Vendor': 'Flashpoint',
                            'Score': 0
                        }
                    }

            return hr, ec, resp


    def domain_lookup_command(client, domain):
        """
        'domain' command to lookup a particular domain

        :param client: object of client class
        :param domain: domain
        :return: command output
        """
        query = r'+type:("domain") +value.\*.keyword:"' + domain + '"'
        resp = client.http_request("GET", url_suffix=get_url_suffix(query))

        if isinstance(resp, list):
            indicators = resp
        else:
            indicators = []

        if len(indicators) > 0:

            hr = '### Flashpoint Domain reputation for ' + domain + '\n'
            hr += 'Reputation: Malicious\n\n'

            events_details = parse_indicator_response(indicators)

            hr += tableToMarkdown('Events in which this IOC observed', events_details['events'],
                                  ['Date Observed (UTC)', 'Name', 'Tags'])

            fp_link = client.url + '/home/search/iocs?group=indicator&ioc_type=domain&ioc_value=' + domain
            hr += '\nAll events and details (fp-tools): [{}]({})\n'.format(fp_link, fp_link)

            dbot_context = {
                'Indicator': domain,
                'Type': 'domain',
                'Vendor': 'Flashpoint',
                'Score': 3
            }

            domain_context = {
                'Name': domain,
                'Malicious': {
                    'Vendor': 'Flashpoint',
                    'Description': 'Found in malicious indicators dataset'
                }

            }

            flashpoint_domain_context = []
            for indicator in resp:
                indicator = indicator.get("Attribute", {})
                event = {
                    'Domain': domain,
                    'Category': indicator.get('category', ''),
                    'Fpid': indicator.get('fpid', ''),
                    'Href': indicator.get('href', ''),
                    'Timestamp': indicator.get('timestamp', ''),
                    'Type': indicator.get('type'),
                    'Uuid': indicator.get('uuid', ''),
                    'EventDetails': indicator.get('Event', []),
                    'Comment': indicator['value'].get('comment', '')
                }
                flashpoint_domain_context.append(event)

            ec = {
                'DBotScore': dbot_context,
                outputPaths['domain']: domain_context,
                FLASHPOINT_PATHS['Domain']: flashpoint_domain_context
            }

            return hr, ec, resp

        else:
            hr = '### Flashpoint Domain reputation for ' + domain + '\n'
            hr += 'Reputation: Unknown\n\n'
            ec = {
                'DBotScore': {
                    'Indicator': domain,
                    'Type': 'domain',
                    'Vendor': 'Flashpoint',
                    'Score': 0
                }
            }

            return hr, ec, resp


    def filename_lookup_command(client, filename):
        """
        'filename' command to lookup a particular filename

        :param client: object of client class
        :param filename: filename
        :return: command output
        """
        query = r'+type:("filename") +value.\*.keyword:"' + filename.replace('\\', '\\\\') + '"'
        resp = client.http_request("GET", url_suffix=get_url_suffix(query))

        if isinstance(resp, list):
            indicators = resp
        else:
            indicators = []

        if len(indicators) > 0:

            hr = '### Flashpoint Filename reputation for ' + filename + '\n'
            hr += 'Reputation: Malicious\n\n'

            events_details = parse_indicator_response(indicators)

            hr += tableToMarkdown('Events in which this IOC observed', events_details['events'],
                                  ['Date Observed (UTC)', 'Name', 'Tags'])

            fp_link = client.url + '/home/search/iocs?group=indicator&ioc_type=filename&ioc_value=' + urllib.parse.quote(
                filename.replace('\\', '\\\\').encode('utf8'))
            hr += '\nAll events and details (fp-tools): [{}]({})\n'.format(fp_link, fp_link)

            dbot_context = {
                'Indicator': filename,
                'Type': 'filename',
                'Vendor': 'Flashpoint',
                'Score': 3
            }

            filename_context = {
                'Name': filename,
                'Malicious': {
                    'Vendor': 'Flashpoint',
                    'Description': 'Found in malicious indicators dataset'
                }

            }

            flashpoint_filename_context = []
            for indicator in resp:
                indicator = indicator.get("Attribute", {})
                event = {
                    'Filename': filename,
                    'Category': indicator.get('category', ''),
                    'Fpid': indicator.get('fpid', ''),
                    'Href': indicator.get('href', ''),
                    'Timestamp': indicator.get('timestamp', ''),
                    'Type': indicator.get('type'),
                    'Uuid': indicator.get('uuid', ''),
                    'EventDetails': indicator.get('Event', []),
                    'Comment': indicator['value'].get('comment', '')
                }
                flashpoint_filename_context.append(event)

            ec = {
                'DBotScore': dbot_context,
                'Filename(val.Name == obj.Name)': filename_context,
                FLASHPOINT_PATHS['Filename']: flashpoint_filename_context
            }

            return hr, ec, resp

        else:
            hr = '### Flashpoint Filename reputation for ' + filename + '\n'
            hr += 'Reputation: Unknown\n\n'
            ec = {
                'DBotScore': {
                    'Indicator': filename,
                    'Type': 'filename',
                    'Vendor': 'Flashpoint',
                    'Score': 0
                }
            }

            return hr, ec, resp


    def url_lookup_command(client, url):
        """
        'url' command to lookup a particular url

        :param client: object of client class
        :param url: url as indicator
        :return: command output
        """
        encoded_url = urllib.parse.quote(url.encode('utf8'))

        query = r'+type:("url") +value.\*.keyword:"' + url + '"'
        resp = client.http_request("GET", url_suffix=get_url_suffix(query))

        if isinstance(resp, list):
            indicators = resp
        else:
            indicators = []

        if len(indicators) > 0:

            hr = '### Flashpoint URL reputation for ' + url + '\n'
            hr += 'Reputation: Malicious\n\n'

            events_details = parse_indicator_response(indicators)

            hr += tableToMarkdown('Events in which this IOC observed', events_details['events'],
                                  ['Date Observed (UTC)', 'Name', 'Tags'])

            fp_link = client.url + '/home/search/iocs?group=indicator&ioc_type=url&ioc_value=' + encoded_url
            hr += '\nAll events and details (fp-tools): [{}]({})\n'.format(fp_link, fp_link)

            dbot_context = {
                'Indicator': url,
                'Type': 'url',
                'Vendor': 'Flashpoint',
                'Score': 3
            }

            url_context = {
                'Name': url,
                'Malicious': {
                    'Vendor': 'Flashpoint',
                    'Description': 'Found in malicious indicators dataset'
                }

            }

            flashpoint_url_context = []
            for indicator in resp:
                indicator = indicator.get("Attribute", {})
                event = {
                    'Fpid': indicator.get('fpid', ''),
                    'EventDetails': indicator['Event'],
                    'Category': indicator.get('category', ''),
                    'Href': indicator.get('href', ''),
                    'Timestamp': indicator.get('timestamp', ''),
                    'Type': indicator.get('type', ''),
                    'Uuid': indicator.get('uuid', ''),
                    'Comment': indicator['value'].get('comment', ''),
                    'Url': indicator['value']['url']
                }
                flashpoint_url_context.append(event)

            ec = {
                'DBotScore': dbot_context,
                outputPaths['url']: url_context,
                FLASHPOINT_PATHS['Url']: flashpoint_url_context
            }

            return hr, ec, resp

        else:
            hr = '### Flashpoint URL reputation for ' + url + '\n'
            hr += 'Reputation: Unknown\n\n'
            ec = {
                'DBotScore': {
                    'Indicator': url,
                    'Type': 'url',
                    'Vendor': 'Flashpoint',
                    'Score': 0
                }
            }

            return hr, ec, resp


    def file_lookup_command(client, file):
        """
        'file' command to lookup a particular file hash (md5, sha1, sha256, sha512)

        :param client: object of client class
        :param file: file as indicator
        :return: command output
        """

        query = r'+type:("md5", "sha1", "sha256", "sha512") +value.\*.keyword:"' + file + '"'
        resp = client.http_request("GET", url_suffix=get_url_suffix(query))

        if isinstance(resp, list):
            indicators = resp
        else:
            indicators = []

        if len(indicators) > 0:
            indicator_type = (indicators[0].get('Attribute', {}).get('type')).upper()
            hr = '### Flashpoint File reputation for ' + file + '\n'
            hr += 'Reputation: Malicious\n\n'

            events_details = parse_indicator_response(indicators)

            hr += tableToMarkdown('Events in which this IOC observed', events_details['events'],
                                  ['Date Observed (UTC)', 'Name', 'Tags'])

            fp_link = client.url + '/home/search/iocs?group=indicator&ioc_type=md5%2Csha1%2Csha256%2Csha512' \
                                   '&ioc_value=' + urllib.parse.quote(file.encode('utf8'))

            hr += '\nAll events and details (fp-tools): [{}]({})\n'.format(fp_link, fp_link)

            flashpoint_file_context = []
            for indicator in resp:
                indicator = indicator.get("Attribute", {})
                event = {
                    str(indicator_type).upper(): file,
                    'EventDetails': indicator.get('Event'),
                    'Category': indicator.get('category', ''),
                    'Fpid': indicator.get('fpid', ''),
                    'Href': indicator.get('href', ''),
                    'Timestamp': indicator.get('timestamp', ''),
                    'Type': indicator.get('type', ''),
                    'Uuid': indicator.get('uuid', ''),
                    'Comment': indicator['value'].get('comment', '')
                }
                flashpoint_file_context.append(event)

            dbot_context = {
                'Indicator': file,
                'Type': indicator_type,
                'Vendor': 'Flashpoint',
                'Score': 3
            }

            file_context = {
                indicator_type: file,
                'Malicious': {
                    'Vendor': 'Flashpoint',
                    'Description': 'Found in malicious indicators dataset'
                }
            }

            ec = {
                'DBotScore': dbot_context,
                outputPaths['file']: file_context,
                FLASHPOINT_PATHS['File']: flashpoint_file_context
            }

            return hr, ec, resp

        else:
            hr = '### Flashpoint File reputation for ' + file + '\n'
            hr += 'Reputation: Unknown\n\n'
            ec = {
                'DBotScore': {
                    'Indicator': file,
                    'Type': 'file',
                    'Vendor': 'Flashpoint',
                    'Score': 0
                }
            }

            return hr, ec, resp


    def email_lookup_command(client, email):
        """
        'email' command to lookup a particular email address or subject

        :param client: object of client class
        :param email: email address or subject
        :return: command output
        """
        query = r'+type:("email-dst", "email-src", "email-src-display-name", "email-subject") +value.\*.keyword:"' \
                + email + '" '
        resp = client.http_request("GET", url_suffix=get_url_suffix(query))

        if isinstance(resp, list):
            indicators = resp
        else:
            indicators = []

        if len(indicators) > 0:

            hr = '### Flashpoint Email reputation for ' + email + '\n'
            hr += 'Reputation: Malicious\n\n'

            events_details = parse_indicator_response(indicators)

            hr += tableToMarkdown('Events in which this IOC observed', events_details['events'],
                                  ['Date Observed (UTC)', 'Name', 'Tags'])

            fp_link = client.url + '/home/search/iocs?group=indicator&ioc_type=email-dst%2Cemail-src%2Cemail-src' \
                                   '-display-name%2Cemail-subject&ioc_value=' + urllib.parse.quote(email.encode('utf8'))
            hr += '\nAll events and details (fp-tools): [{}]({})\n'.format(fp_link, fp_link)

            email_context = {
                'Name': email,
                'Malicious': {
                    'Vendor': 'Flashpoint',
                    'Description': 'Found in malicious indicators dataset'
                }
            }

            dbot_context = {
                'Indicator': email,
                'Type': 'email',
                'Vendor': 'Flashpoint',
                'Score': 3
            }

            flashpoint_email_context = []
            for indicator in resp:
                indicator = indicator.get("Attribute", {})
                event = {
                    'EventDetails': indicator.get('Event', ''),
                    'Category': indicator.get('category', ''),
                    'Fpid': indicator.get('fpid', ''),
                    'Href': indicator.get('href', ''),
                    'Timestamp': indicator.get('timestamp', ''),
                    'Type': indicator.get('type', ''),
                    'Uuid': indicator.get('uuid', ''),
                    'Comment': indicator['value'].get('comment', '')
                }
                flashpoint_email_context.append(event)

            ec = {
                'DBotScore': dbot_context,
                outputPaths['email']: email_context,
                FLASHPOINT_PATHS['Email']: flashpoint_email_context
            }

            return hr, ec, resp

        else:
            hr = '### Flashpoint Email reputation for ' + email + '\n'
            hr += 'Reputation: Unknown\n\n'
            ec = {
                'DBotScore': {
                    'Indicator': email,
                    'Type': 'email',
                    'Vendor': 'Flashpoint',
                    'Score': 0
                }
            }

            return hr, ec, resp


    def common_lookup_command(client, indicator_value):
        """
        Command to lookup all types of the indicators

        :param client: object of client class
        :param indicator_value: value of the indicator to lookup
        :return: command output
        """
        encoded_value = urllib.parse.quote(indicator_value.encode('utf8'))

        try:
            ipaddress.ip_address(indicator_value)
            query = r'+type:("ip-src","ip-dst") +value.\*:"' + indicator_value + '"'
        except ValueError:
            try:
                ipaddress.IPv6Address(indicator_value)
                query = r'+type:("ip-src","ip-dst") +value.\*:"' + indicator_value + '"'
            except ValueError:
                query = r'+value.\*.keyword:"' + indicator_value + '"'

        resp = client.http_request("GET", url_suffix=get_url_suffix(query))

        if isinstance(resp, list):
            indicators = resp
        else:
            indicators = []

        if len(indicators) > 0:

            indicator_type = indicators[0].get('Attribute', {}).get('type')

            hr = '### Flashpoint reputation for ' + indicator_value + '\n'
            hr += 'Reputation: Malicious\n\n'

            events_details = parse_indicator_response(indicators)

            hr += tableToMarkdown('Events in which this IOC observed', events_details['events'],
                                  ['Date Observed (UTC)', 'Name', 'Tags'])

            fp_link = client.url + '/home/search/iocs?group=indicator&ioc_value=' + encoded_value
            hr += '\nAll events and details (fp-tools): [{}]({})\n'.format(fp_link, fp_link)

            ec = {'DBotScore': {
                'Indicator': indicator_value,
                'Type': indicator_type,
                'Vendor': 'Flashpoint',
                'Score': 3
            }}

            return hr, ec, resp

        else:
            hr = '### Flashpoint reputation for ' + indicator_value + '\n'
            hr += 'Reputation: Unknown\n\n'
            ec = {}

            return hr, ec, resp


    def get_reports_command(client, report_search):
        """
        Get reports matching the given search term or query

        :param client: object of client class
        :param report_search: search term or query
        :return: command output
        """
        url_suffix = '/reports/?query=' + urllib.parse.quote(report_search) + '&limit=5'
        resp = client.http_request("GET", url_suffix=url_suffix)
        reports = resp.get("data", [])

        hr = '### Flashpoint Intelligence reports related to search: ' + report_search + '\n'
        ec: Dict[Any, Any] = {}

        if reports:
            hr += 'Top 5 reports:\n\n'
            report_details = []
            index = 0
            for report in reports:
                title = report.get('title', 'N/A')
                platform_url = report.get('platform_url', '')
                summary = report.get('summary', 'N/A')
                index += 1
                hr += '' + str(index) + ') [{}]({})'.format(title, platform_url) + '\n'
                if report.get('summary'):
                    hr += '   Summary: ' + str(summary) + '\n\n\n'
                else:
                    hr += '   Summary: N/A\n\n\n'

                report_detail = {
                    'ReportId': report.get('id', 'N/A'),
                    'UpdatedAt': report.get('updated_at', ''),
                    'PostedAt': report.get('posted_at', ''),
                    'NotifiedAt': report.get('notified_at', ''),
                    'PlatformUrl': platform_url,
                    'Title': title,
                    'Summary': summary
                }
                report_details.append(report_detail)

            fp_url = client.url + '/home/search/reports?query=' + urllib.parse.quote(report_search)
            hr += 'Link to Report-search on Flashpoint platform: [{}]({})\n'.format(fp_url, fp_url)

            ec[FLASHPOINT_PATHS['Report']] = report_details

        else:
            hr += 'No reports found for the search.'

        return hr, ec, resp


    def get_report_by_id_command(client, report_id):
        """
        Get specific report using its fpid

        :param client: object of client class
        :param report_id: report's fpid
        :return: command output
        """
        url_suffix = '/reports/' + urllib.parse.quote(report_id.encode('utf-8'))
        resp = client.http_request("GET", url_suffix=url_suffix)
        report = resp

        hr = '### Flashpoint Intelligence Report details\n'
        ec: Dict[Any, Any] = {}

        if report:

            if report.get('tags') is None:
                raise ValueError("No record found for given argument(s): Not Found")

            timestamp = None
            try:
                time_str = report.get('posted_at', '')[:-10] + 'UTC'
                timestamp = time.strptime(time_str, '%Y-%m-%dT%H:%M:%S%Z')
            except TypeError:
                pass
            except ValueError:
                pass

            tags = report.get('tags', [])
            tag_string = ""
            for tag in tags:
                tag_string += ", " + str(tag)
            if tag_string:
                tag_string = tag_string[2:]

            if timestamp:
                timestamp_str = time.strftime('%b %d, %Y  %H:%M', timestamp)
            else:
                timestamp_str = 'N/A'

            report_details = [{
                'Title': '[{}]({})'.format(report.get('title', 'N/A'), report.get('platform_url', '')),
                'Date Published (UTC)': timestamp_str,
                'Summary': report.get('summary', 'N/A'),
                'Tags': tag_string
            }]

            hr += tableToMarkdown('Below are the details found:', report_details,
                                  ['Title', 'Date Published (UTC)', 'Summary', 'Tags'])
            hr += '\n'
            ec[FLASHPOINT_PATHS['Report']] = {
                'ReportId': report.get('id', ''),
                'UpdatedAt': report.get('updated_at', ''),
                'PostedAt': report.get('posted_at', ''),
                'NotifiedAt': report.get('notified_at', ''),
                'PlatformUrl': report.get('platform_url', ''),
                'Title': report.get('title', ''),
                'Summary': report.get('summary', '')
            }

        else:
            hr += 'No report found for the given ID.'

        return hr, ec, resp


    def get_related_reports_command(client, report_id):
        """
        Get reports related to given report

        :param report_id: report id which is related to other reports
        :param client: object of client class
        :return: command output
        """
        url_suffix = '/reports/' + urllib.parse.quote(report_id.encode('utf-8')) + '/related?limit=5'
        resp = client.http_request("GET", url_suffix=url_suffix)
        reports = resp.get("data", [])

        hr = '### Flashpoint Intelligence related reports:\n'
        ec: Dict[Any, Any] = {}

        if reports:
            hr += 'Top 5 related reports:\n\n'
            report_details = []
            index = 0
            for report in reports:
                title = report.get('title', 'N/A')
                platform_url = report.get('platform_url', '')
                summary = report.get('summary', 'N/A')
                index += 1
                hr += '' + str(index) + ') [{}]({})'.format(title, platform_url) + '\n'
                hr += '   Summary: ' + str(summary) + '\n\n\n'
                report_detail = {
                    'ReportId': report.get('id', 'N/A'),
                    'UpdatedAt': report.get('updated_at', ''),
                    'PostedAt': report.get('posted_at', ''),
                    'NotifiedAt': report.get('notified_at', ''),
                    'PlatformUrl': platform_url,
                    'Title': title,
                    'Summary': summary
                }
                report_details.append(report_detail)

            fp_url = client.url + '/home/intelligence/reports/report/' + report_id + '#detail'
            hr += 'Link to the given Report on Flashpoint platform: [{}]({})\n'.format(fp_url, fp_url)
            ec[FLASHPOINT_PATHS['Report']] = report_details

        else:
            hr += 'No related reports found for the search.'

        return hr, ec, resp


    def get_event_by_id_command(client, event_id):
        """
        Get specific event using its event id

        :param client: object of client class
        :param event_id: event's fpid
        :return: command output
        """
        url_suffix = '/indicators/event/' + urllib.parse.quote(event_id.encode('utf-8'))
        resp = client.http_request("GET", url_suffix=url_suffix)

        hr = '### Flashpoint Event details\n'
        ec: Dict[Any, Any] = {}

        if len(resp) <= 0:
            hr += 'No event found for the given ID.'
            return hr, ec, resp

        event = resp[0].get('Event', '')
        fpid = resp[0].get('fpid', '')
        href = resp[0].get('href', '')

        events = []
        if event:
            event = parse_event_response(client, event, fpid, href)
            events.append(event)
            hr += tableToMarkdown('Below are the detail found:', events, ['Observed time (UTC)', 'Name', 'Tags'])

            ec[FLASHPOINT_PATHS['Event']] = {
                'EventId': events[0]['EventId'],
                'Name': events[0]['Name'],
                'Tags': events[0]['Tags'],
                'ObservedTime': events[0]['Observed time (UTC)'],
                'EventCreatorEmail': event['EventCreatorEmail'],
                'Href': href
            }

        return hr, ec, resp


    def get_events_command(client, limit, report_fpid, attack_ids, time_period):
        """
        Get events matching the given parameters

        :param client: object of client class
        :param limit: limit of the records
        :param report_fpid: report fpid to fetch events
        :param attack_ids: array of attack ids of event
        :param time_period: time period i.e 2M, 3d etc
        :return: command output
        """
        url_suffix = '/indicators/event?sort_timestamp=desc&'
        getvars = {}
        if limit:
            getvars['limit'] = limit

        if report_fpid:
            getvars['report'] = report_fpid

        if attack_ids:
            getvars['attack_ids'] = attack_ids

        if time_period:
            getvars['time_period'] = time_period

        url_suffix = url_suffix + urllib.parse.urlencode(getvars)

        resp = client.http_request("GET", url_suffix=url_suffix)
        indicators = resp
        hr = ''
        ec: Dict[Any, Any] = {}
        if len(indicators) > 0:
            hr += '### Flashpoint Events\n\n'

            events = []
            for indicator in indicators:
                href = indicator.get('href', '')
                event = indicator.get('Event', {})
                fpid = indicator.get('fpid', '')
                event = parse_event_response(client, event, fpid, href)
                events.append(event)

            hr += tableToMarkdown('Below are the detail found:', events, ['Observed time (UTC)', 'Name', 'Tags'])

            fp_link = client.url + '/home/search/iocs'
            if attack_ids:
                fp_link = fp_link + '?attack_ids=' + urllib.parse.quote(attack_ids)
            hr += '\nAll events and details (fp-tools): [{}]({})\n'.format(fp_link, fp_link)

            # Replacing the dict keys for ec  to strip any white spaces and special charcters
            for event in events:
                replace_key(event, 'ObservedTime', 'Observed time (UTC)')

            ec[FLASHPOINT_PATHS['Event']] = events

        else:
            hr += 'No event found for the argument.'

        return hr, ec, resp


    def get_forum_details_by_id_command(client, forum_id):
        """
        Get specific forum details by its fpid

        :param client: object of client class
        :param forum_id: forum's fpid
        :return: command output
        """
        url_suffix = '/forums/sites/' + urllib.parse.quote(forum_id.encode('utf-8'))
        resp = client.http_request("GET", url_suffix=url_suffix)

        hr = '### Flashpoint Forum details\n'
        ec = {}

        if resp:
            forum_details = parse_forum_response(resp)
            hr += tableToMarkdown('Below are the details found:', forum_details, ['Name', 'Hostname', 'Tags'])
            hr += '\n'

            ec[FLASHPOINT_PATHS['Forum']] = {
                'ForumId': resp['id'],
                'Hostname': resp['hostname'],
                'Description': resp['description'],
                'Name': resp['name'],
                'Stats': resp['stats'],
                'Tags': resp['tags']
            }

        else:
            hr += 'No forum detail found for given forum id.'

        return hr, ec, resp


    def get_room_details_by_id_command(client, room_id):
        """
        Get room details by its room id

        :param client: object of client class
        :param room_id: room's fpid
        :return: command output
        """
        url_suffix = '/forums/rooms/' + urllib.parse.quote(room_id.encode('utf-8')) + '?embed=forum'
        resp = client.http_request("GET", url_suffix=url_suffix)

        hr = '### Flashpoint Room details\n'
        ec = {}

        if resp:
            forum_name = resp['embed']['forum']['name']
            url = resp.get('url', '')
            title = resp.get('title', '')

            room_details = {
                'Forum Name': forum_name,
                'Title': title,
                'URL': url
            }

            hr += tableToMarkdown('Below are the detail found:', room_details, ['Forum Name', 'Title', 'URL'])
            hr += '\n'

            ec[FLASHPOINT_PATHS['Room']] = {
                'RoomId': resp['id'],
                'Title': title,
                'Url': url,
                'Forum': resp['embed']['forum']
            }

        else:
            hr += 'No room details found for given room id'

        return hr, ec, resp


    def get_user_details_by_id_command(client, user_id):
        """
        Get user details by user's fpid

        :param client: object of client class
        :param user_id: user's fpid
        :return: command output
        """
        url_suffix = '/forums/users/' + urllib.parse.quote(user_id.encode('utf-8')) + '?embed=forum'
        resp = client.http_request("GET", url_suffix=url_suffix)

        hr = '### Flashpoint User details\n'
        ec = {}

        if resp:
            forum_name = resp['embed']['forum']['name']
            url = resp.get('url', '')
            name = resp.get('name', '')

            user_details = {
                'Forum Name': forum_name,
                'Name': name,
                'URL': url
            }

            hr += tableToMarkdown('Below are the detail found:', user_details, ['Forum Name', 'Name', 'URL'])
            hr += '\n'

            ec[FLASHPOINT_PATHS['User']] = {
                'UserId': resp['id'],
                'Name': name,
                'Url': url,
                'PlatformUrl': resp.get('platform_url', ''),
                'Forum': resp['embed']['forum']
            }

        else:
            hr += 'No user details found for given user id'

        return hr, ec, resp


    def get_post_details_by_id_command(client, post_id):
        """
        Get forum post details by post's fpid

        :param client: object of client class
        :param post_id: fpid of post
        :return: command output
        """
        url_suffix = '/forums/posts/' + urllib.parse.quote(
            post_id.encode('utf-8')) + '?body_html=stripped&embed=author,room,forum,thread'
        resp = client.http_request("GET", url_suffix=url_suffix)

        hr = '### Flashpoint Post details\n'
        ec = {}

        if resp:
            published_at = resp.get('published_at', '')
            url = resp.get('url', '')
            platform_url = resp.get('platform_url', '')
            forum_name = resp['embed']['forum']['name']
            room_title = resp['embed']['room']['title']
            author_name = resp['embed']['author']['name']
            thread_title = resp['embed']['thread']['title']

            post_details = {
                'Published at': published_at,
                'Forum Name': forum_name,
                'Room Title': room_title,
                'Author Name': author_name,
                'Thread Title': thread_title,
                'URL': url,
                'Platform url': "[{}]({})".format(platform_url, platform_url)
            }

            hr += tableToMarkdown('Below are the detail found:', post_details,
                                  ['Published at', 'Forum Name', 'Room Title', 'Author Name', 'Thread Title', 'URL',
                                   'Platform url'])
            hr += '\n'
            post_ec = get_post_context(resp)
            ec[FLASHPOINT_PATHS['Post']] = post_ec

        else:
            hr += 'No post details found for given post id'

        return hr, ec, resp


    def get_forum_sites_command(client, site_search):
        """
        Get forum sites matching search keyword or query

        :param client: object of client class
        :param site_search: site's keyword or query
        :return: command output
        """
        url_suffix = '/forums/sites/?query=' + urllib.parse.quote(site_search.encode('utf8')) + '&limit=10'
        resp = client.http_request("GET", url_suffix=url_suffix)
        sites = resp.get("data", [])

        hr = '### Flashpoint Forum sites related to search: ' + site_search + '\n'
        ec: Dict[Any, Any] = {}

        if sites:
            hr += 'Top 10 sites:\n\n'
            site_details = []
            for site in sites:
                site_detail = {
                    'SiteId': site.get('id', ''),
                    'Name': site.get('name', 'N/A'),
                    'Hostname': site.get('hostname', 'N/A'),
                    'Description': site.get('description', 'N/A'),
                    'PlatformUrl': site.get('platform_url', ''),
                    'Tags': site.get('tags', [])
                }

                site_details.append(site_detail)

            hr += tableToMarkdown('Below are the detail found:', site_details, ['Name', 'Hostname', 'Description'])
            hr += '\n'

            ec = {
                FLASHPOINT_PATHS['Site']: site_details
            }

        else:
            hr += 'No forum sites found for the search'

        return hr, ec, resp


    def get_forum_posts_command(client, post_search):
        """
        Get forum posts details matching given keyword or query

        :param client: object of client class
        :param post_search: keyword or query for search in posts
        :return: command output
        """
        url_suffix = '/forums/posts/?query=' + urllib.parse.quote(
            post_search.encode('utf8')) + '&limit=10&embed=forum,room,author,thread'
        resp = client.http_request("GET", url_suffix=url_suffix)
        posts = resp.get("data", [])

        hr = '### Flashpoint Forum posts related to search: ' + post_search + '\n'
        ec: Dict[Any, Any] = {}

        if posts:
            hr += 'Top 10 posts:\n\n'
            post_details = []
            post_entry_context = []
            for post in posts:
                platform_url = post.get('platform_url', '')
                thread_title = post['embed']['thread']['title']
                post_ec = get_post_context(post)
                post_entry_context.append(post_ec)
                post_detail = {
                    'Forum Name': post['embed']['forum']['name'],
                    'Thread Title': thread_title[:30] + '....',
                    'Room Title': post['embed']['room']['title'],
                    'Author Name': post['embed']['author']['name'],
                    'Platform URL': '[{}]({})'.format(platform_url[:30] + '...', platform_url)
                }
                post_details.append(post_detail)

            hr += tableToMarkdown('Below are the detail found:', post_details,
                                  ['Forum Name', 'Thread Title', 'Room Title', 'Author Name', 'Platform URL'])
            hr += '\n'

            fp_url = client.url + '/home/search/forums?query=' + urllib.parse.quote(post_search.encode('utf8'))
            hr += 'Link to forum post-search on Flashpoint platform: [{}]({})\n'.format(fp_url, fp_url)

            ec[FLASHPOINT_PATHS['Post']] = post_entry_context

        else:
            hr += 'No forum posts found for the search'

        return hr, ec, resp


    def main():
        """
        PARSE AND VALIDATE INTEGRATION PARAMS
        """
        api_key = get_apikey()
        url = demisto.params()["url"]
        verify_certificate = not demisto.params().get('insecure', False)

        proxies = handle_proxy()
        try:
            client = Client(api_key, url, verify_certificate, proxies)

            if demisto.command() == 'test-module':
                # This is the call made when pressing the integration Test button.
                ip_lookup_command(client, "8.8.8.8")
                demisto.results('ok')

            elif demisto.command() == 'ip':
                ip = demisto.args()['ip']
                reputation_operation_command(client, ip, ip_lookup_command)

            elif demisto.command() == 'domain':
                domain = demisto.args()['domain']
                reputation_operation_command(client, domain, domain_lookup_command)

            elif demisto.command() == 'filename':
                filename = demisto.args()['filename']
                reputation_operation_command(client, filename, filename_lookup_command)

            elif demisto.command() == 'url':
                url = demisto.args()['url']
                reputation_operation_command(client, url, url_lookup_command)

            elif demisto.command() == 'file':
                file = demisto.args()['file']
                reputation_operation_command(client, file, file_lookup_command)

            elif demisto.command() == 'email':
                email = demisto.args()['email']
                reputation_operation_command(client, email, email_lookup_command)

            elif demisto.command() == 'flashpoint-common-lookup':
                indicator_value = demisto.args()['indicator']
                reputation_operation_command(client, indicator_value, common_lookup_command)

            elif demisto.command() == 'flashpoint-search-intelligence-reports':
                report_search = demisto.args()['report_search']
                return_outputs(*get_reports_command(client, report_search))

            elif demisto.command() == 'flashpoint-get-single-intelligence-report':
                report_id = demisto.args()['report_id']
                return_outputs(*get_report_by_id_command(client, report_id))

            elif demisto.command() == 'flashpoint-get-related-reports':
                report_id = demisto.args()['report_id']
                return_outputs(*get_related_reports_command(client, report_id))

            elif demisto.command() == 'flashpoint-get-single-event':
                event_id = demisto.args()['event_id']
                return_outputs(*get_event_by_id_command(client, event_id))

            elif demisto.command() == 'flashpoint-get-events':
                args = demisto.args()
                limit = args.get('limit', 10)
                report_fpid = args.get('report_fpid')
                attack_ids = args.get('attack_ids')
                time_period = args.get('time_period')
                return_outputs(*get_events_command(client, limit, report_fpid, attack_ids, time_period))

            elif demisto.command() == 'flashpoint-get-forum-details':
                forum_id = demisto.args()['forum_id']
                return_outputs(*get_forum_details_by_id_command(client, forum_id))

            elif demisto.command() == 'flashpoint-get-forum-room-details':
                room_id = demisto.args()['room_id']
                return_outputs(*get_room_details_by_id_command(client, room_id))

            elif demisto.command() == 'flashpoint-get-forum-user-details':
                user_id = demisto.args()['user_id']
                return_outputs(*get_user_details_by_id_command(client, user_id))

            elif demisto.command() == 'flashpoint-get-forum-post-details':
                post_id = demisto.args()['post_id']
                return_outputs(*get_post_details_by_id_command(client, post_id))

            elif demisto.command() == 'flashpoint-search-forum-sites':
                site_search = demisto.args()['site_search']
                return_outputs(*get_forum_sites_command(client, site_search))

            elif demisto.command() == 'flashpoint-search-forum-posts':
                post_search = demisto.args()['post_search']
                return_outputs(*get_forum_posts_command(client, post_search))

        except ValueError as v_err:
            return_error(str(v_err))
        except requests.exceptions.ConnectionError as c:
            """ Caused mostly when URL is altered."""
            return_error(f'Failed to execute {demisto.command()} command. Error: {str(c)}')
        except Exception as e:
            return_error(f'Failed to execute {demisto.command()} command. Error: {str(e)}')


    if __name__ in ['__main__', 'builtin', 'builtins']:
        main()
  subtype: python3
  type: python
system: true
